---
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

async function fetchRecipeIllustration(recipe: CollectionEntry<"recipes">): Promise<{ default: ImageMetadata }> {
  const images = import.meta.glob<{ default: ImageMetadata }>("/src/content/assets/recipes/*.jpg");

  const illustration = images[`/src/content/assets/recipes/${recipe.id}.jpg`];

  if (!illustration) {
    throw new Error(`Cannot find illustration for ${recipe.id}`);
  }

  return await illustration();
}

interface Props {
  recipe: CollectionEntry<"recipes">;
  class?: string;
}

const { recipe, class: className } = Astro.props;
const illustration = await fetchRecipeIllustration(recipe);
---

<Image
  src={illustration.default}
  alt={`${recipe.data.title} illustration`}
  loading="lazy"
  decoding="async"
  quality={50}
  format="webp"
  width={600}
  class={className}
/>
