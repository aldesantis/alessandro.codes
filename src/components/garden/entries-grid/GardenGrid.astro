---
import { search } from "src/actions/search";
import Card from "@components/ui/Card.astro";

interface Props {
  searchParams: Parameters<typeof search>[0];
  itemSize: "S" | "M" | "L";
  layoutType?: "grid" | "masonry";
}

const { searchParams, itemSize, layoutType = "grid" } = Astro.props;

function getGridColumnsForSize(size: "S" | "M" | "L"): string {
  switch (size) {
    case "S":
      return "grid-cols-1 sm:grid-cols-2 lg:grid-cols-4";
    case "M":
      return "grid-cols-1 sm:grid-cols-2 lg:grid-cols-3";
    case "L":
      return "grid-cols-1 sm:grid-cols-2 lg:grid-cols-2";
  }
}

function getMasonryColumnsForSize(size: "S" | "M" | "L"): string {
  switch (size) {
    case "S":
      return "columns-1 sm:columns-2 lg:columns-4";
    case "M":
      return "columns-1 sm:columns-2 lg:columns-3";
    case "L":
      return "columns-1 sm:columns-2 lg:columns-2";
  }
}
---

<div
  class="space-y-4"
  data-controller="garden-grid"
  data-garden-grid-search-params-value={JSON.stringify(searchParams)}
>
  <template data-garden-grid-target="loadingTemplate">
    <div class={layoutType === "grid" ? "col-span-full" : "[column-span:all]"}>
      <Card>
        <p>Loading the results...</p>
      </Card>
    </div>
  </template>

  <template data-garden-grid-target="emptyTemplate">
    <div class={layoutType === "grid" ? "col-span-full" : "[column-span:all]"}>
      <Card>
        <p>Nothing here yet! Check back soon.</p>
      </Card>
    </div>
  </template>

  <template data-garden-grid-target="errorTemplate">
    <div class={layoutType === "grid" ? "col-span-full" : "[column-span:all]"}>
      <Card>
        <p>Failed to load the results.</p>
      </Card>
    </div>
  </template>

  <template data-garden-grid-target="cardTemplate">
    <div
      class={layoutType === "grid" ? "mb-4" : "mb-4 break-inside-avoid"}
      data-controller="garden-lazy-card"
      data-garden-lazy-card-entry-id-value=""
      data-garden-lazy-card-entry-collection-value=""
    >
    </div>
  </template>

  <div
    data-garden-grid-target="grid"
    class={layoutType === "grid"
      ? `grid ${getGridColumnsForSize(itemSize)} gap-4`
      : `columns ${getMasonryColumnsForSize(itemSize)} gap-4 [column-fill:balance]`}
  >
  </div>
</div>
