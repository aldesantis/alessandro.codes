---
import GardenFilterDropdown from "./GardenFilterDropdown.astro";
import type { FilterConfig } from "src/lib/garden/filters";
import type { GardenEntryTypeId } from "src/lib/garden/entries";

interface Props {
  entryTypes: GardenEntryTypeId[];
  itemSize: "S" | "M" | "L";
  filters?: FilterConfig[];
  layoutType?: "grid" | "masonry";
}

const { entryTypes, itemSize, filters = [], layoutType = "grid" } = Astro.props;

function getGridColumnsForSize(size: "S" | "M" | "L"): string {
  switch (size) {
    case "S":
      return "grid-cols-1 sm:grid-cols-2 lg:grid-cols-4";
    case "M":
      return "grid-cols-1 sm:grid-cols-2 lg:grid-cols-3";
    case "L":
      return "grid-cols-1 sm:grid-cols-2 lg:grid-cols-2";
  }
}

function getMasonryColumnsForSize(size: "S" | "M" | "L"): string {
  switch (size) {
    case "S":
      return "columns-1 sm:columns-2 lg:columns-4";
    case "M":
      return "columns-1 sm:columns-2 lg:columns-3";
    case "L":
      return "columns-1 sm:columns-2 lg:columns-2";
  }
}

---

<div
  data-controller="garden-filters garden-entries-grid"
  data-garden-filters-filter-categories-value={JSON.stringify(filters.map((filter) => filter.category))}
  class="space-y-4"
>
  {
    filters.length > 0 && (
      <div class="flex gap-2">
        {filters.map((filter) => (
          <GardenFilterDropdown label={filter.label} filterCategory={filter.category} items={filter.items} />
        ))}
      </div>
    )
  }

  <div
    data-garden-entries-grid-target="grid"
    data-garden-entries-grid-entry-types-value={JSON.stringify(entryTypes)}
    data-garden-entries-grid-layout-type-value={layoutType}
    data-garden-entries-grid-item-size-value={itemSize}
    class={layoutType === "grid"
      ? `grid ${getGridColumnsForSize(itemSize)} gap-4`
      : `columns ${getMasonryColumnsForSize(itemSize)} gap-4 [column-fill:balance]`}
  >
    <div class="col-span-full flex items-center justify-center p-8">
      <div class="text-gray-500 dark:text-gray-400">Loading entries...</div>
    </div>
  </div>
</div>
