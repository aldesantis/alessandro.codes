---
import { getEntry } from "src/lib/zendo/content";
import { collectionIds } from "garden.config";
import ContentCard from "@components/content/ContentCard.astro";
import type { ZendoCollectionId } from "src/lib/zendo/content";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const paths = [];

  for (const collection of collectionIds) {
    const collectionEntries = await getCollection(collection);

    for (const entry of collectionEntries) {
      paths.push({
        params: {
          collection: collection as string,
          id: entry.id,
        },
      });
    }
  }

  return paths;
}

const { collection, id } = Astro.params;

if (!collection || !id) {
  throw new Error("Collection and id parameters are required");
}

if (!collectionIds.includes(collection as ZendoCollectionId)) {
  throw new Error(`Invalid collection: ${collection}`);
}

const entry = await getEntry(collection as ZendoCollectionId, id);

if (!entry) {
  throw new Error(`Entry not found: ${id} in collection ${collection}`);
}
---

<ContentCard content={entry} />
