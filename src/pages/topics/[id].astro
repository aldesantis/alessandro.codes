---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import ArrowLink from "@components/ui/ArrowLink.astro";
import { render } from "astro:content";
import { getMdxComponents, getRelatedContent } from "src/lib/content";
import Prose from "@components/ui/Prose.astro";
import ContentCard from "@components/content/ContentCard.astro";
import TopicMeta from "@components/topics/TopicMeta.astro";

export async function getStaticPaths() {
  const topics = await getCollection("topics");

  return topics.map((topic) => ({
    params: { id: topic.id },
    props: { topic },
  }));
}

const { topic } = Astro.props;
const { Content } = await render(topic);
const relatedContent = await getRelatedContent(topic);
---

<title slot="head">{topic.data.title} | Alessandro Desantis</title>

<Layout>
  <div class="max-w-3xl mx-auto">
    <div class="mb-4">
      <ArrowLink
        href="/topics"
        arrowDirection="left"
        class="font-sans font-semibold uppercase"
        slot="navigation"
      >
        Topics
      </ArrowLink>

      <h1 class="text-4xl font-semibold font-sans mt-2 mb-1">
        {topic.data.title}
      </h1>

      <div class="mb-2">
        <TopicMeta content={topic} />
      </div>
    </div>

    <Prose>
      <Content components={getMdxComponents()} />
    </Prose>
  </div>

  {
    relatedContent.length > 0 && (
      <div class="mt-12">
        <div class="columns-1 sm:columns-3 gap-6 [column-fill:balance]">
          {relatedContent.map((content) => (
            <div class="break-inside-avoid mb-6">
              <ContentCard content={content} />
            </div>
          ))}
        </div>
      </div>
    )
  }
</Layout>
